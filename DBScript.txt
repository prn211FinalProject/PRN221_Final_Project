-- Tạo cơ sở dữ liệu LibraryManagement
--CREATE DATABASE LMS_PRN221;
--DROP DATABASE LMS_PRN221;

-- Sử dụng cơ sở dữ liệu LibraryManagement
USE LMS_PRN221;
Go

-- Bảng Role (vai trò của user)
CREATE TABLE Role (
    Id INT PRIMARY KEY IDENTITY,
    Name NVARCHAR(255),
    Status BIT
);

-- Bảng User (người dùng)
CREATE TABLE [User] (
    Uid INT PRIMARY KEY IDENTITY,
    FullName NVARCHAR(255),
    Email NVARCHAR(255) UNIQUE,
    Phone NVARCHAR(20),
    Status BIT,
	Gender BIT,
	[PassWord] varchar(255),
    RoleId INT FOREIGN KEY REFERENCES Role(Id)
);

-- Bảng Category (thể loại sách)
CREATE TABLE Category (
    Id INT PRIMARY KEY IDENTITY,
    CName NVARCHAR(255),
    Status BIT
);

-- Bảng Publisher (nhà xuất bản)
CREATE TABLE Publisher (
    Id INT PRIMARY KEY IDENTITY,
    PName NVARCHAR(255),
    Address NVARCHAR(255),
    Phone NVARCHAR(20),
    Email NVARCHAR(255),
    Status BIT
);

-- Bảng Book (sách)
CREATE TABLE Book (
    Id INT PRIMARY KEY IDENTITY,
    CId INT FOREIGN KEY REFERENCES Category(Id),
    BName NVARCHAR(255),
    Author NVARCHAR(255),
    Quantity INT,
    Image NVARCHAR(255),
    Price DECIMAL(10, 2),
	[Description] nvarchar(255),
    Status BIT,
	[Hide] BIT NOT NULL DEFAULT 0,
    PublisherId INT FOREIGN KEY REFERENCES Publisher(Id),
    PublishDate DATETIME
);

-- Bảng Feedback (đánh giá sách)
CREATE TABLE Feedback (
    Id INT PRIMARY KEY IDENTITY,
    Bid INT FOREIGN KEY REFERENCES Book(Id),
    Uid INT FOREIGN KEY REFERENCES [User](Uid),
    Content NVARCHAR(MAX),
    CreatedDate DATETIME,
    Status BIT
);

-- Bảng Wishlist (danh sách yêu thích của người dùng)
CREATE TABLE Wishlist (
    Id INT PRIMARY KEY IDENTITY,
    Uid INT FOREIGN KEY REFERENCES [User](Uid)
);

-- Bảng WishlistItem (mục trong danh sách yêu thích)
CREATE TABLE WishlistItem (
    WId INT FOREIGN KEY REFERENCES Wishlist(Id),
    BId INT FOREIGN KEY REFERENCES Book(Id),
    PRIMARY KEY (WId, BId)
);

-- Bảng Borrow Information (thông tin mượn sách)
CREATE TABLE BorrowInformation (
    Oid INT PRIMARY KEY IDENTITY,
    Uid INT FOREIGN KEY REFERENCES [User](Uid),
    BorrowDate DATETIME,
    DueDate DATETIME,
    TotalAmount DECIMAL(10, 2),
    Note NVARCHAR(MAX),
    Status BIT
);

-- Bảng Borrow Detail (chi tiết mượn sách)
CREATE TABLE BorrowDetail (
    Oid INT FOREIGN KEY REFERENCES BorrowInformation(Oid),
    Bid INT FOREIGN KEY REFERENCES Book(Id),
    PRIMARY KEY (Oid, Bid)
);

-- Bảng Blog (blog về sách hoặc hệ thống)
CREATE TABLE Blog (
    Bid INT PRIMARY KEY IDENTITY,
    Title NVARCHAR(255),
    Content NVARCHAR(MAX),
    CreatedDate DATETIME,
    Status BIT,
	Uid INT FOREIGN KEY REFERENCES [User](Uid)
);
--- Thêm dữ liệu vào bảng Role (vai trò của user)
INSERT INTO Role (Name, Status)
VALUES 
    (N'Staff', 1),
    (N'Guest', 1);

-- Thêm dữ liệu vào bảng User (người dùng)
INSERT INTO [User] (FullName, Email, Phone, Status, Gender, [PassWord], RoleId)
VALUES 
    (N'Phạm Quang D', 'phamd@example.com', '0911111111', 1, 1, 'password123', 1),
    (N'Hoàng Thị E', 'hoange@example.com', '0922222222', 1, 0, 'password456', 2),
    (N'Nguyễn Văn F', 'nguyenf@example.com', '0933333333', 1, 1, 'password789', 3);

-- Thêm dữ liệu vào bảng Category (thể loại sách)
INSERT INTO Category (CName, Status)
VALUES 
    (N'Philosophy', 1),
    (N'Children', 1);

-- Thêm dữ liệu vào bảng Publisher (nhà xuất bản)
INSERT INTO Publisher (PName, Address, Phone, Email, Status)
VALUES 
    (N'NXB Văn Học', N'Hà Nội', '0912345678', 'vanhoc@example.com', 1),
    (N'NXB Tự Nhiên', N'TP HCM', '0923456789', 'tunhien@example.com', 1);

-- Thêm dữ liệu vào bảng Book (sách)
INSERT INTO Book (CId, BName, Author, Quantity, Image, Price, [Description], Status, PublisherId, PublishDate)
VALUES 
    (4, N'Triết Học Tinh Hoa', N'Trần Văn Đ', 8, 'image4.jpg', 95000, N'Sách giới thiệu các triết lý nổi bật.', 1, 1, '2020-10-25'),
    (5, N'Câu Chuyện Tuổi Thơ', N'Phạm Lan Hương', 15, 'image5.jpg', 50000, N'Sách dành cho trẻ em với hình ảnh sinh động.', 1, 2, '2019-03-14');

-- Thêm dữ liệu vào bảng Feedback (đánh giá sách)
INSERT INTO Feedback (Bid, Uid, Content, CreatedDate, Status)
VALUES 
    (4, 1, N'Triết lý rất sâu sắc!', '2023-04-02', 1),
    (5, 2, N'Sách này giúp trẻ em phát triển tư duy sáng tạo.', '2023-04-10', 1);

-- Thêm dữ liệu vào bảng Wishlist (danh sách yêu thích của người dùng)
INSERT INTO Wishlist (Uid)
VALUES 
    (3),
    (4);

-- Thêm dữ liệu vào bảng WishlistItem (mục trong danh sách yêu thích)
INSERT INTO WishlistItem (WId, BId)
VALUES 
    (3, 4),
    (3, 5),
    (4, 1);

-- Thêm dữ liệu vào bảng BorrowInformation (thông tin mượn sách)
INSERT INTO BorrowInformation (Uid, BorrowDate, DueDate, TotalAmount, Note, Status)
VALUES 
    (3, '2023-07-15', '2023-07-30', 45000, N'Mượn sách triết học', 1),
    (4, '2023-09-15', '2023-09-30', 30000, N'Mượn sách cho trẻ em', 1);

-- Thêm dữ liệu vào bảng BorrowDetail (chi tiết mượn sách)
INSERT INTO BorrowDetail (Oid, Bid)
VALUES 
    (3, 4),
    (3, 5),
    (4, 1);

-- Thêm dữ liệu vào bảng Blog (blog về sách hoặc hệ thống)
INSERT INTO Blog (Title, Content, CreatedDate, Status, Uid)
VALUES 
    (N'Những sách triết học nên đọc', N'Bài viết chia sẻ về các sách triết học nên đọc...', '2023-06-15', 1, 3),
    (N'Cuốn sách hay cho trẻ em', N'Giới thiệu sách giúp trẻ em phát triển toàn diện...', '2023-07-20', 1, 4);